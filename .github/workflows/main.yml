name: GitHub-Profile-3D-Contrib

on:
  schedule: # 03:00 JST == 18:00 UTC
    - cron: "0 18 * * *"
  workflow_dispatch:

# 1. 권한 설정 추가 (403 오류 해결을 위해 필수)
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    name: generate-github-profile-3d-contrib
    steps:
      - uses: actions/checkout@v3

      # -----------------------------------------------------
      # 2. 기존: 3D Contribution Profile 생성
      # -----------------------------------------------------
      - uses: yoshi389111/github-profile-3d-contrib@0.7.1
        env:
          GITHUB_TOKEN: ${{ secrets.README_TOKEN }}
          USERNAME: ${{ github.repository_owner }}

      # 3. 3D 프로필 파일 커밋 & 푸시 (수동 푸시 필요)
      - name: Commit & Push 3D Profile
        run: |
          git config user.name yeaseul7
          git config user.email cutie32769@gmail.com
          git add -A .
          # 변동 사항이 있을 때만 커밋하도록 설정 (오류 방지)
          git diff --staged --quiet || git commit -m "generated 3d profile"
          git push

      # -----------------------------------------------------
      # 4. 추가: Isometric Commit Calendar (Metrics)
      # -----------------------------------------------------
      - name: Isometric Commit Calendar
        uses: lowlighter/metrics@latest
        with:
          # 파일이 저장될 이름
          filename: isometric-calendar.svg
          # GitHub Token (기존에 쓰시던 토큰 사용)
          token: ${{ secrets.README_TOKEN }}
          
          # 기본 설정 (헤더 등 불필요한 정보 숨기기)
          base: ""
          
          # Isocalendar 플러그인 활성화
          plugin_isocalendar: yes
          plugin_isocalendar_duration: half-year # 표시 기간 (half-year 또는 full-year)

          # -----------------------------------------------------
      # 4. Recently Starred (Metrics) - [추가된 부분]
      # -----------------------------------------------------
      - name: Recently Starred
        uses: lowlighter/metrics@latest
        with:
          filename: metrics.plugin.stars.svg
          # 토큰 이름을 통일했습니다 (기존에 쓰시던 README_TOKEN 사용)
          token: ${{ secrets.README_TOKEN }}
          base: ""
          plugin_stars: yes
          plugin_stars_limit: 3
